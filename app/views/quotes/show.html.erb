<h2><%= @quote.client.name %> <%= content_tag(:span, @quote.rating, :class => "badge badge-#{@quote.rating.downcase}") %>
  <span class='submenu'>
    <%= icon_button_link_to "#{t 'print', default: 'Print'}", '#print-modal', icon: "print", large: true, level: "primary", white: true, "data-toggle" => "modal" %>
    <% if @quote.confirmed? && @quote.invoice.blank? %>
      <%= button_link_to "#{t 'create_invoice'}", new_quote_invoice_path(@quote), level: "success", large: true %>
    <% end %>  
    <% unless @quote.client.email.blank? %>
      <%= icon_button_link_to "#{t 'email_to_client'}", email_quote_path, :method => :post, level: "success", large: true, icon: 'envelope', white: true, disabled_with: "#{t 'email_to_client'}" %>
    <% end %>
    <% if @quote.rejected? %>
      <%= link_to "#{t 'rejected', default: 'Rejected'}", '#', :class => 'btn btn-warning btn-large disabled' %>
      <%= button_link_to "#{t 'edit', default: 'Edit'}", edit_quote_path(@quote), level: "inverse", large: true unless @quote.signed? %>
    <% else %>
      <%= button_link_to "#{t 'edit', default: 'Edit'}", edit_quote_path(@quote), level: "inverse", large: true unless @quote.signed? %>
      <% if @quote.confirmed? %>
        <%= link_to "#{t 'confirmed', default: 'Confirmed'}", '#', :class => 'btn btn-success btn-large disabled', "data-original-title"=>"Confirmation",
        "data-content"=> "#{render(template: 'quote_confirmations/show', locals: {quote_confirmation: @quote.quote_confirmation}, formats: [:html])}", "data-placement" => "left", :id => "confirm" %>
      <% else %>
        <%= button_link_to "#{t 'reject', default: 'Reject'}", reject_quote_path(@quote), level: "warning", large: true, method: :put, confirm: "#{t 'confirm_reject', defaut: 'Are you sure you want to reject this quote?'}" %>
        <%= button_link_to "#{t 'confirm', default: 'Confirm'}", confirmation_quote_path(@quote), level: "success", large: true, remote: true %>
      <% end %>
    <% end %>
  </span>
</h2>

<%= render 'q_header', quote: @quote %>

<div class="span6 well col2 odd">
  <h3><%= t 'from' %> <%= "#{t 'internal'}" if @quote.internal_address %></h3>
  <div class="storage">
  <% if @quote.from_address.has_storage? %>
    <h6><%= t 'storage' %>: <%= @quote.from_address.storage.name %></h6>
    <%= address_for(@quote.from_address.storage.address) %>
  <% else %>
    <h6><%= t 'address' %></h6>
    <%= address_for(@quote.from_address.address) %>        
  <% end %>
  </div>
</div>

<% unless @quote.internal_address? %>
<div class="span6 well col2 even">
  <h3><%= t 'to' %></h3>
  <% if !@quote.to_addresses.blank? %>
    <% for to_address in @quote.to_addresses %>
      <div class="storage">
      <% if to_address.has_storage? %>
        <h6><%= t 'storage' %>: <%= to_address.storage.name %></h6>
        <%= address_for(to_address.storage.address) %>
      <% else %>
        <h6><%= t 'address' %></h6>
        <%= address_for(to_address.address) %>        
      <% end %>
      </div>
    <% end %>
  <% end %>
</div>
<% end %>

<%= section %>
<%= render 'rooms' %>

<%= section %>
<%= render 'price' %>
<%= render 'optional' %>
<%= render 'documents' %>
<%= render 'confirmation' %>

<!-- PRINT MODAL -->
<div class="modal" id="print-modal">
  <%= form_tag print_quote_path(:format => :pdf), :method => :get do %>
  <div class="modal-header">
    <button class="close" data-dismiss="modal">Ã—</button>
    <h3><%= t 'select_addresses_to_print', default: 'Select addresses to print' %></h3>
  </div>
  <div class="modal-body">
    <h3><%= t 'from' %> <%= "#{t 'internal'}" if @quote.internal_address %></h3>
    <div class="address">
    <% if @quote.from_address.has_storage? %>
      <h6><%= t 'storage' %>: <%= @quote.from_address.storage.name %></h6>
      <%= address_for(@quote.from_address.storage.address) %>
    <% else %>
      <h6><%= t 'address' %></h6>
      <%= address_for(@quote.from_address.address) %>        
    <% end %>
    </div>
    
    <h3><%= t 'to' %></h3>
    <% if !@quote.to_addresses.blank? %>
      <% for to_address in @quote.to_addresses %>
        <div class="address">
        <%= check_box_tag 'to[]', to_address.id %>  
        <% if to_address.has_storage? %>
          <h6><%= t 'storage' %>: <%= to_address.storage.name %></h6>
          <%= address_for(to_address.storage.address) %>
        <% else %>
          <h6><%= t 'address' %></h6>
          <%= address_for(to_address.address) %>        
        <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal"><%= t 'close' %></a>
    <%= submit_tag t('print', default: 'Print'), class: "btn btn-primary", name: nil %>
  </div>
  <% end %>
</div>

<script type="text/javascript" charset="utf-8">
  $(function() {
    $("#confirm")
      .popover({
          // offset: 10,
          trigger: 'manual',
          animate: false,
          html: true,
          placement: 'top',
          template: '<div class="popover" onmouseover="$(this).mouseleave(function() {$(this).hide(); });"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'
      }).click(function(e) {
          e.preventDefault() ;
      }).mouseenter(function(e) {
          $(this).popover('show');
      });
  });
</script>